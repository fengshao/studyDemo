webpackJsonp([10],{25:function(t,e,i){(function(e,a){try{(function(){"use strict";var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},o=i(3),n=o.Form.Item,s=i(8),l={},c=window.navigator.userAgent;c.indexOf("MSIE")>=1?l.ie=!0:c.indexOf("Firefox")>=1?l.firefox=!0:c.indexOf("Chrome")>=1&&(l.chrome=!0);var p=window.sessionStorage.getItem("user_role"),d=e.createClass({displayName:"EditForm",getInitialState:function(){return{imgSrc:this.props.editRowData.img_wechat}},componentWillUnmount:function(){a("body").css("overflow","hidden")},componentDidMount:function(){a("body").css("overflow","auto")},confirm:function(t){this.props.deleteSpecialFnc(t)},checkfile:function(){if(3!=p)return!0;try{var t=1024*this.props.appImgSize*1024,e="您的浏览器暂不支持计算上传文件的大小，确保上传文件不要超过"+this.props.appImgSize+"M，建议使用IE、FireFox、Chrome浏览器。",i=a("#fileForm #file")[0];if(""==i.value)return!1;var r=0;if(l.firefox||l.chrome)r=i.files[0].size;else{if(!l.ie)return o.message.warning(e),!1;var n=document.getElementById("tempimg");n.dynsrc=i.value,r=n.fileSize}return r==-1?(o.message.warning(e),!1):!(r>t)}catch(s){o.message.warning(s)}},checkSpecialName:function(t,e,i){for(var a=!1,r=0;r<this.props.allData.length;r++)if(e==this.props.allData[r].title&&this.props.editRowData.id!=this.props.allData[r].id){a=!0;break}a?i([new Error("抱歉，该专题名称已被占用。")]):i()},checkSpecialUrl:function(t,e,i){/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(e)?i():i([new Error("抱歉，请输入有效的网址。")])},checkSpecialSort:function(t,e,i){/^\d+$/.test(e)||i([new Error("抱歉，请输入数字。")]);for(var a=!1,r=0;r<this.props.allData.length;r++)if(e==this.props.allData[r].sort&&this.props.editRowData.id!=this.props.allData[r].id){a=!0;break}a?i([new Error("抱歉，该排序序号已被占用。")]):i()},checkImgType:function(t,e,i){if(!e&&this.state.imgSrc)return void i();if(!e)return void i([new Error("抱歉，请选择png，jpg，jpeg，gif格式的图片上传。")]);var a=e.substr(e.lastIndexOf(".")).toLowerCase();".jpg"!=a&&".png"!=a&&".jpeg"!=a&&".gif"!=a?i([new Error("抱歉，请选择png，jpg，jpeg，gif格式的图片上传。")]):this.checkfile()?i():i([new Error("抱歉，请选择png，jpg，jpeg，gif格式并小于"+this.props.appImgSize+"M 的文件上传。")])},saveSpecial:function(){var t=this,e=this;return this.state.imgSrc||this.props.editRowData.img_wechat?void this.props.form.validateFields(function(i,r){r.img_app=t.state.imgSrc,r.img_wechat=t.state.imgSrc,r.img_qq=t.state.imgSrc;var o=!1;a.each(r,function(t,i){i!=e.props.editRowData[t]&&(o=!0)}),!i&&o&&(e.props.editRowData.id?(r.id=e.props.editRowData.id,r.type_id=e.props.editRowData.type_id,e.props.editSpecial(r)):(r.type_id=e.props.typeID,e.props.addSpecial(r)))}):void o.message.warning("请上传图片")},uploadImage:function(){var t=this,e=new FormData(a("#fileForm")[0]);this.checkfile()&&a.ajax({method:"post",url:s.publicParms.url,data:e,dataType:"JSON",cache:!1,processData:!1,contentType:!1,success:function(e){if(e&&e.result){var i=e.result,a=s.publicParms.httpStr+i.savepath+"/"+i.savename;t.setState({imgSrc:a})}},error:function(t){o.message.error("上传失败")}})},render:function(){var t=window.sessionStorage.getItem("user_role"),i=this.props.form,a=i.getFieldProps,s=i.getFieldError,l=i.isFieldValidating,c=a("title",{rules:[{required:!0,max:20,message:"专题名称最多为 20 个字符"},{validator:this.checkSpecialName}],initialValue:this.props.editRowData.title?this.props.editRowData.title:""});if(1==t)var p=a("url_wechat",{rules:[{required:!0,message:"微信链接不能为空"},{validator:this.checkSpecialUrl}],initialValue:this.props.editRowData.url_wechat?this.props.editRowData.url_wechat:""}),d=a("url_qq",{rules:[{required:!0,message:"手Q链接不能为空"},{validator:this.checkSpecialUrl}],initialValue:this.props.editRowData.url_qq?this.props.editRowData.url_qq:""});else var h=a("url_app",{rules:[{required:!0,message:"APP链接不能为空"}],initialValue:this.props.editRowData.url_app?this.props.editRowData.url_app:""});var u=a("sort",{rules:[{required:!0,message:"排序不能为空"},{validator:this.checkSpecialSort}],initialValue:this.props.editRowData.sort?this.props.editRowData.sort.toString():this.props.editRowData.sort}),m=a("img_wechat",{validate:[{rules:[{validator:this.checkImgType}],trigger:["onChange"]}]}),f={labelCol:{span:7},wrapperCol:{span:12}};return e.createElement("div",null,e.createElement(o.Form,{horizontal:!0,className:"editform",id:"fileForm"},e.createElement(n,r({label:"专题图片",hasFeedback:!0},f,{help:l("img_wechat")?"校验中...":(s("img_wechat")||[]).join(", ")}),e.createElement(o.Input,r({},m,{type:"file",id:"file",name:"file",className:"upload-img",accept:"image/png, image/jpg, image/jpeg, image/gif",style:{width:"70%",marginRight:8}})),e.createElement(o.Button,{onClick:this.uploadImage,className:"upload-btn"},"上传"))),e.createElement(o.Form,{horizontal:!0,className:"editform"},e.createElement(n,r({},f,{label:"图片预览",hasFeedback:!0}),e.createElement("img",{src:this.state.imgSrc?this.state.imgSrc:this.props.editRowData.img_wechat,className:"preview-img"})),e.createElement(n,r({},f,{label:"专题名称",hasFeedback:!0,help:l("title")?"校验中...":(s("title")||[]).join(", ")}),e.createElement(o.Input,r({},c,{placeholder:"请输入专题名称"}))),1==t?e.createElement("div",null,e.createElement(n,r({},f,{label:"手Q链接",hasFeedback:!0,help:l("url_qq")?"校验中...":(s("url_qq")||[]).join(", ")}),e.createElement(o.Input,r({},d,{placeholder:"请输入手Q链接"}))),e.createElement(n,r({},f,{label:"微信链接",hasFeedback:!0,help:l("url_wechat")?"校验中...":(s("url_wechat")||[]).join(", ")}),e.createElement(o.Input,r({},p,{placeholder:"请输入微信链接"})))):e.createElement(n,r({},f,{label:"APP链接",hasFeedback:!0,help:l("url_app")?"校验中...":(s("url_app")||[]).join(", ")}),e.createElement(o.Input,r({},h,{placeholder:"请输入APP链接"}))),e.createElement(n,r({},f,{label:"排序",hasFeedback:!0,help:l("sort")?"校验中...":(s("sort")||[]).join(", ")}),e.createElement(o.Input,r({placeholder:"请输入排序序号"},u))),e.createElement(n,{wrapperCol:{span:12,offset:7}},e.createElement(o.Button,{type:"primary",onClick:this.saveSpecial},"确定"),"   ",e.createElement(o.Button,{type:"ghost",onClick:this.props.hideEditFrom},"返回"))))}});d=o.Form.create()(d),t.exports=d}).call(this)}finally{}}).call(e,i(2),i(4))},26:function(t,e,i){(function(e,a){try{(function(){"use strict";var r=i(3),o=e.createClass({displayName:"TableComponent",getInitialState:function(){return{tableHeight:a(window).height()-56-30-130-80-(this.props.topNavHeight?this.props.topNavHeight:0)}},resizeWindow:function(){var t=a(window).height()-56-30-130-80-60-(this.props.topNavHeight?this.props.topNavHeight:0);this.setState({tableHeight:t})},componentWillUnmount:function(){a("body").css("overflow","auto"),a(window).off("resize",this.resizeWindow)},confirm:function(t){this.props.deleteSpecialFnc(t)},getTableColumns:function(){var t=this,i=window.sessionStorage.getItem("user_role"),a=[{title:"ID",dataIndex:"id",width:"8%",key:"id_key",sorter:function(t,e){return t.id-e.id}},{title:"专题名称",dataIndex:"title",width:"20%",key:"title_key"},{title:1==i?"微信链接":"APP链接",dataIndex:1==i?"url_wechat":"url_app",width:"22%",key:"url_key"},{title:"专题封面",dataIndex:"img_wechat",width:"18%",key:"img_key",render:function(t){return e.createElement("img",{className:"td-img",src:t})}},{title:"排序",dataIndex:"sort",width:"8%",key:"sort_key",sorter:function(t,e){return t.sort-e.sort}},{title:"操作",width:"12%",render:function(i,a,o){var n="确定要删除吗？";return e.createElement("div",{className:"operate-div"},e.createElement(r.Button,{className:"operate-btn",type:"primary",onClick:t.props.showEditFrom.bind(t,a)},"修改"),e.createElement(r.Popconfirm,{placement:"topRight",title:n,onConfirm:t.confirm.bind(t,a)},e.createElement(r.Button,null,"删除")))}}];return a},getPagination:function(){return{total:this.props.tableData?this.props.tableData.length:0,showTotal:function(t){return"共 "+t+" 条"},defaultCurrent:1,pageSize:10,showQuickJumper:!0,showSizeChanger:!0}},componentDidMount:function(){a("body").css("overflow","hidden"),a(window).on("resize",this.resizeWindow)},titleElement:function(){return e.createElement("div",null,e.createElement("span",null,this.props.titleData),e.createElement(r.Button,{type:"primary",onClick:this.props.showAddFrom},"添加"))},render:function(){var t=this.getTableColumns(),i=this.getPagination(),a=this.props.tableData,o=this.state.tableHeight,n=this.titleElement();return e.createElement(r.Table,{title:function(){return n},bordered:!0,columns:t,dataSource:a,pagination:i,scroll:{y:o}})}});t.exports=o}).call(this)}finally{}}).call(e,i(2),i(4))},193:function(t,e,i){try{(function(){"use strict";function e(){this.generateActions("getSpecialList","deleteSpecial","addSpecial","editSpecial","showEditFrom","showAddFrom","hideEditFrom"),this.getSpecialList=function(t){var e=this;a.getSpecialList(t).then(function(t){e.dispatch(t.data)},function(t){e.dispatch(t)})},this.addSpecial=function(t){var e=this;a.addSpecial(t).then(function(i){e.actions.getSpecialList(t.type_id)},function(t){e.dispatch(t)})},this.editSpecial=function(t){var e=this;a.editSpecial(t).then(function(i){e.actions.getSpecialList(t.type_id)},function(t){e.dispatch(t)})},this.deleteSpecial=function(t){var e=this,i={id:t.id,type_id:t.type_id};a.deleteSpecial(i).then(function(t){e.dispatch({id:i.id,data:t})},function(t){e.dispatch(t)})}}var a=i(8);t.exports=alt.createActions(e)}).call(this)}finally{}},398:function(t,e,i){(function(e){try{(function(){"use strict";var a=i(26),r=i(25),o=i(399),n=i(193),s=e.createClass({displayName:"Special",getInitialState:function(){var t=o.getState();return t},onChange:function(){var t=o.getState();this.setState(t)},componentDidMount:function(){o.listen(this.onChange),n.getSpecialList(this.props.location.query.type_id)},componentWillUnmount:function(){o.unlisten(this.onChange),alt.flush()},events:{deleteSpecialFnc:function(t){n.deleteSpecial(t)},showEditFrom:function(t){n.showEditFrom(t)},showAddFrom:function(){n.showAddFrom()},addSpecial:function(t){n.addSpecial(t)},editSpecial:function(t){n.editSpecial(t)},hideEditFrom:function(){n.hideEditFrom()}},render:function(){var t=this.props.location.query.type_name,i=this.props.location.query.type_id;return e.createElement("div",null,this.state.isShowEditFrom||this.state.isShowAddFrom?e.createElement(r,{hideEditFrom:this.events.hideEditFrom,addSpecial:this.events.addSpecial,editSpecial:this.events.editSpecial,allData:this.state.specialList,typeID:i,editRowData:this.state.editRowData,appImgSize:.2}):e.createElement(a,{tableData:this.state.specialList,titleData:t,deleteSpecialFnc:this.events.deleteSpecialFnc,showEditFrom:this.events.showEditFrom,showAddFrom:this.events.showAddFrom}))}});t.exports=s}).call(this)}finally{}}).call(e,i(2))},399:function(t,e,i){try{(function(){"use strict";function e(){this.specialList=[],this.editRowData={title:"",sort:"",id:"",url_wechat:"",url_qq:"",url_app:"",img_qq:"",img_app:"",img_wechat:""},this.isShowEditFrom=!1,this.isShowAddFrom=!1,this.bindActions(a)}var a=i(193);e.prototype.getSpecialList=function(t){this.editRowData={title:"",sort:"",id:"",url_wechat:"",url_qq:"",url_app:"",img_qq:"",img_app:"",img_wechat:""},this.isShowEditFrom=!1,this.isShowAddFrom=!1,this.specialList=t?t:[]},e.prototype.deleteSpecial=function(t){if(0==t.data.error)for(var e=t.id,i=0;i<this.specialList.length;i++)e==this.specialList[i].id&&this.specialList.splice(i,1)},e.prototype.showEditFrom=function(t){this.editRowData=t,this.isShowEditFrom=!0},e.prototype.showAddFrom=function(){this.editRowData={title:"",sort:"",id:"",url_wechat:"",url_qq:"",url_app:"",img_qq:"",img_app:"",img_wechat:""},this.isShowAddFrom=!0},e.prototype.addSpecial=function(){},e.prototype.editSpecial=function(){},e.prototype.hideEditFrom=function(){this.editRowData={title:"",sort:"",id:"",url_wechat:"",url_qq:"",url_app:"",img_qq:"",img_app:"",img_wechat:""},this.isShowEditFrom=!1,this.isShowAddFrom=!1},t.exports=alt.createStore(e,"SpecialStore")}).call(this)}finally{}}});
//# sourceMappingURL=10.10.3a453b604985e3111624.2553cab252dce0fb37e0.js.map