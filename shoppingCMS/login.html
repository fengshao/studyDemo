<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>商城CMS登录</title>
	<meta name="description" content="slick Login">
	<meta name="author" content="Webdesigntuts+">
	<link rel="stylesheet" type="text/css" href="./style/login.css"/>
	<script language="JavaScript" src="./script/jquery-3.1.0.js"></script>
	<script>
		var errorUserNameTimer = null;
		var errorPasswordTimer = null;
		var loginFlag = false;
		function userLogin(type) {
			var locationHref = window.location.href;
			var url = "http://han.wesai.com/api/userLogin";

			if (locationHref.indexOf("devel") != -1) {
				url = "http://han.devel.wesai.com/api/userLogin";
			} else if (locationHref.indexOf("test") != -1) {
				url = "http://han.test.wesai.com/api/userLogin";
			}

			var username = document.getElementById("name").value.trim();
			var password = document.getElementById("password").value.trim();
			if (loginFlag) {
				return;
			}
			if (username == "") {
				$("#name").val("");
				$("#check-username").addClass("show-error-prompt");
				if (errorUserNameTimer) {
					errorUserNameTimer = null;
				}
				errorUserNameTimer = setTimeout(function () {
					$("#check-username").removeClass("show-error-prompt");
				}, 1500);
				return false;
			}
			if (password == "") {
				$("#check-pwd").addClass("show-error-prompt");
				$("#password").val("");
				if (errorPasswordTimer) {
					errorPasswordTimer = null;
				}
				errorPasswordTimer = setTimeout(function () {
					$("#check-pwd").removeClass("show-error-prompt");
				}, 1500);
				return false;
			}
			loginFlag = true;
			var data = {};
			data.name = username;
			data.password = password;

			$.ajax({
				"type": "post",
				"data": data,
				"url": url,
				"success": function (data) {
					if (data.error == 0) {
						$(".login-file-prompt").removeClass("show-login-prompt");
						$(".login-success-prompt").addClass("show-login-prompt");
						window.sessionStorage.setItem("username", username);
						window.sessionStorage.setItem("user", data.user);
						setTimeout(function () {
							$(".login-success-prompt span").text("2");
						}, 1000);
						setTimeout(function () {
							$(".login-success-prompt span").text("1");
						}, 2000);
						setTimeout(function () {
//							$(".login-success-prompt span").text("0");
							if (type != 1) {
								window.location.href = "./view/index.html";
							}
							loginFlag = false;
						}, 3000);
					} else {
						loginFlag = false;
						$(".login-file-prompt").html(data.message ? data.message : "登录失败，请重试").addClass("show-login-prompt");
					}
				},
				"error": function (data) {
					if (data.error == 0) {
						$(".login-file-prompt").removeClass("show-login-prompt");
						$(".login-success-prompt").addClass("show-login-prompt");
						window.sessionStorage.setItem("username", username);
						setTimeout(function () {
							$(".login-success-prompt span").text("2");
						}, 1000);
						setTimeout(function () {
							$(".login-success-prompt span").text("1");
						}, 2000);
						setTimeout(function () {
							$(".login-success-prompt span").text("0");
							if (type != 1) {
								window.location.href = "./view/index.html";
							}
							loginFlag = false;
						}, 3000);
					} else {
						loginFlag = false;
						$(".login-file-prompt").html(data.message ? data.message : "登录失败，请重试").addClass("show-login-prompt");
					}
				}
			});
		}
	</script>
</head>

<body>
<form id="slick-login">
	<label>username</label>
	<input type="text" name="name" id="name" class="placeholder"
		   placeholder="username"/>
	<label id="check-username">用户名不能为空</label>
	<label>password</label>
	<input type="password" name="password" id="password" class="placeholder"
		   placeholder="password"/>
	<label id="check-pwd">密码不能为空</label>
	<input type="button" value="Log In" onclick="userLogin()">
	<label class="login-success-prompt">登录成功，即将进行跳转。。。<span>3</span></label>
	<label class="login-file-prompt">登录失败，请重试</label>
</form>
</body>

</html>