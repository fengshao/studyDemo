<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<!--<meta name="renderer" content="webkit">-->

	<title> 祝：前程似锦</title>

	<link type="text/css" rel="stylesheet" href="./source/default.css">
	<link href="./css/font/iconfont.css" rel="stylesheet" type="text/css"/>

	<script type="text/javascript" src="./source/jquery.min.js"></script>
	<script type="text/javascript" src="./source/jscex.min.js"></script>
	<script type="text/javascript" src="./source/jscex-parser.js"></script>
	<script type="text/javascript" src="./source/jscex-jit.js"></script>
	<script type="text/javascript" src="./source/jscex-builderbase.min.js"></script>
	<script type="text/javascript" src="./source/jscex-async.min.js"></script>
	<script type="text/javascript" src="./source/jscex-async-powerpack.min.js"></script>
	<script type="text/javascript" src="./source/functions.js" charset="utf-8"></script>
	<script type="text/javascript" src="./source/love.js" charset="utf-8"></script>
	<style type="text/css">
		<!--
		.STYLE1 {
			color: #666666
		}

		-->
	</style>
</head>
<body>
<script type="">
	function loadCSS() {
		if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|iOS|iPad|Android|wOSBrowser|BrowserNG|WebOS)/i))) {
		} else {
			window.location.href = "../pc/index.html"
		}
	}
	loadCSS();
</script>
<div class="music-btn" title="关闭背景音乐">
	<i class="iconfont icon-music-open"></i>
	<i class="iconfont icon-music-suspend" style="display: none"></i>
</div>
<div class="mask" id="mask">
	<div class="mask-box">
		<div class="mask-pic"><i></i></div>
		<span>为了更好的体验，请将设备竖过来</span>
	</div>
</div>
<audio id="bg-music" src="./GHYJN.mp3" autoplay="autoplay" loop="loop"></audio>
<div id="main">
	<div id="error">本页面采用HTML5编辑，目前您的浏览器无法显示，请换成谷歌(<a href="http://rj.baidu.com/soft/detail/14744.html?ald">Chrome</a>)或者火狐(<a
			href="http://rj.baidu.com/soft/detail/11843.html">Firefox</a>)浏览器，或者其他游览器的最新版本。
	</div>
	<div id="wrap">
		<div id="text">
			<div id="code">
				<font color="#FF0000"> <span class="say">亲爱的CP</span><br>
					<span class="say">相遇即是有缘，七天转瞬即逝，群中午就解散了呢，不会被拉黑吧❥(ゝω・✿ฺ)。。。</span><br>
					<span class="say">连你本名都不晓得呢，看到ZF 第一反应是zheng feng - -|| 感觉戒备心好强啊。。小姐姐。。我好像比你大三届呢。也不知道该说点啥，仓促之间也没啥好的创意，找了个模板改了改。主题好像不太符合，就当祝你七夕快乐了。不要介意哈。。。</span><br>
					<span class="say">约吗，小姐姐｡：ﾟ(｡ﾉω＼｡)ﾟ･｡ </span><br>
					<span class="say"><span class="space"></span>祝：前程似锦，早日完成想做的事情</span><br>
                    <span class="say" style="display: inline-block;text-align: right;width: 100%;"><span
							class="space"></span>by： 你帅气的CP 疯子</span>
				</font></p>
			</div>
		</div>
		<div id="clock-box">
			<span class="STYLE1"></span><font color="#33CC00">截至今天我们已经</font>
			<span class="STYLE1"> 认识了</span>
			<div id="clock"></div>
		</div>
		<canvas id="canvas"></canvas>
	</div>

</div>

<script>
</script>

<script>

	var cliWH = document.documentElement.clientWidth;
	var cliHG = document.documentElement.clientHeight;
	$("body").css("height", cliHG).css("width", cliWH);
	//防止屏幕拖动
	document.documentElement.addEventListener('touchmove', function (e) {
		e.preventDefault();
	});
	if (cliHG < cliWH) {
		//横屏
		document.querySelector(".mask").style.display = "none";
	} else {
		//竖屏
		document.querySelector(".mask").style.display = "block";
	}

	(function () {


		$("body").delegate(".music-btn", "click", function () {
			var music = document.getElementById("bg-music");
			if ($(this).hasClass("close-music-music")) {
				$(this).removeClass("close-music-music");
				music.play();
			} else {
				$(this).addClass("close-music-music");
				music.pause();
			}
		});

		var canvas = $('#canvas');

		if (!canvas[0].getContext) {
			$("#error").show();
			return false;
		}
		var width = canvas.width();
		var height = canvas.height();
		canvas.attr("width", width);
		canvas.attr("height", height);
		var opts = {
			seed: {
				x: width / 2 - 20,
				color: "rgb(190, 26, 37)",//
				scale: 2
			},
			branch: [
				[width / 2, height, width / 2 + 45, 50, width / 2 - 20, 30, 20, 100,
					[
						[width / 2 + 10, height - 80, width / 2 - 45, height - 150, 200, height / 2 + 40, 13, 100,
							[[width / 2 - 50, height - 135, height - 140, height - 150, width / 2 - 100, height / 2 + 30, 2, 40]
							]],
						[width / 2 + 15, height - 130, width / 2 + 70, height - 200, width / 2 + 150, height / 2, 10, 100, [
							[width / 2 + 50, height - 160, height + 100, height - 150, width - 250, height - 150, 3, 80]
						]],
						[width / 2 + 15, 80, width / 2 + 15, 50, width / 2 + 15, 40, 3, 40],
						[width / 2 + 15, height / 2 + 30, height / 2 + 150, height - 280, 200, 80, 9, 80,
							[
								[width / 2 - 100, height / 2 - 100, height / 2 + 20, height / 2 - 150, width / 2 - 150, 50, 2, 40],
								[width / 2 - 30, height / 2 - 50, height / 2 + 20, height / 2 - 80, width / 2 - 140, height - 270, 4, 60]
							]],
						[width / 2 + 20, height / 2 - 20, height / 2 + 300, height - 350, width / 2 + 200, 80, 6, 100, [
							[width / 2 + 90, height / 2 - 80, width / 2 + 100, height / 2 - 60, width - 200, height / 2 - 60, 2, 80]
						]]
					]]
			],
			bloom: {
				num: 350,
				width: width,
				height: height - 40
			},
			footer: {
				width: width,
				height: 5,
				speed: 10
			}
		};

		var tree = new Tree(canvas[0], width, height, opts);
		var seed = tree.seed;
		var foot = tree.footer;
		var hold = 1;

		canvas.click(function (e) {
			var offset = canvas.offset(), x, y;
			x = e.pageX - offset.left;
			y = e.pageY - offset.top;
			if (seed.hover(x, y)) {
				hold = 0;
				canvas.unbind("click");
				canvas.unbind("mousemove");
				canvas.removeClass('hand');
			}
		}).mousemove(function (e) {
			var offset = canvas.offset(), x, y;
			x = e.pageX - offset.left;
			y = e.pageY - offset.top;
			canvas.toggleClass('hand', seed.hover(x, y));
		});

		var seedAnimate = eval(Jscex.compile("async", function () {
			seed.draw();
			while (hold) {
				$await(Jscex.Async.sleep(10));
			}
			while (seed.canScale()) {
				seed.scale(0.95);
				$await(Jscex.Async.sleep(10));
			}
			while (seed.canMove()) {
				seed.move(0, 2);
				foot.draw();
				$await(Jscex.Async.sleep(10));
			}
		}));

		var growAnimate = eval(Jscex.compile("async", function () {
			do {
				tree.grow();
				$await(Jscex.Async.sleep(10));
			} while (tree.canGrow());
		}));

		var flowAnimate = eval(Jscex.compile("async", function () {
			do {
				tree.flower(2);
				$await(Jscex.Async.sleep(10));
			} while (tree.canFlower());
		}));

		var moveAnimate = eval(Jscex.compile("async", function () {
			tree.snapshot("p1", 120, 0, 500, height);
			while (tree.move("p1", width / 2 - 90, 0)) {
				console.log("moveAnimate");
				foot.draw();
				$await(Jscex.Async.sleep(10));
			}
			foot.draw();
			tree.snapshot("p2", 300, 0, 500, height);

			// 会有闪烁不得意这样做, (＞﹏＜)
			canvas.parent().css("background", "url(" + tree.toDataURL('image/png') + ")");
			canvas.css("background", "#ffe");
			$await(Jscex.Async.sleep(300));
			canvas.css("background", "none");
		}));

		var jumpAnimate = eval(Jscex.compile("async", function () {
			var ctx = tree.ctx;
			while (true) {
				tree.ctx.clearRect(0, 0, width, height);
				tree.jump();
				foot.draw();
				$await(Jscex.Async.sleep(25));
			}
		}));

		var textAnimate = eval(Jscex.compile("async", function () {
			var together = new Date();
			together.setFullYear(2017, 7 - 1, 21); 			//时间年月日
			together.setHours(22);						//小时
			together.setMinutes(1);					//分钟
			together.setSeconds(0);					//秒前一位
			together.setMilliseconds(2);				//秒第二位

			$("#code").show().typewriter();
			$("#clock-box").fadeIn(500);
			while (true) {
				timeElapse(together);
				$await(Jscex.Async.sleep(1000));
			}
		}));

		var runAsync = eval(Jscex.compile("async", function () {
			$await(seedAnimate());
			$await(growAnimate());
			$await(flowAnimate());
			$await(moveAnimate());

			textAnimate().start();

			$await(jumpAnimate());
		}));

		runAsync().start();
	})();
</script>
</body>
</html>
